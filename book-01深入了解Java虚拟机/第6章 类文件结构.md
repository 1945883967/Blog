#  第六章 类文件结构



代码编译的结果从本地机器码转变为字节码（Java的.class文件）。

计算机只认识0和1，所以我们写的程序需要经编译器翻译成0和1构成的二进制格式才能由计算机执行。但随着技术的发展，越来越多的程序设计语言选择了与操作系统和机器指令集无关的、平台中立的格式作为编译后的存储格式。

## 6.2无关性的基石

各种**不同的虚拟机**与**所有平台**都统一使用的程序存储格式---**字节码**（ByteCode)是构成平台无关性的基石。

实现**语言无关性**基石仍然是**虚拟机和字节码存储格式**。Java虚拟机不和包括Java在内的任何语言绑定，它只与**“Class文件"**这种特定的二进制文件格式所关联，Class文件包含了Java虚拟机**指令集**和**符号表**以及若干其他辅助信息。基于安全方面的考虑，Java虚拟机规 范要求在Class文件中使用许多强制性的语法和结构化约束，但任何一门功能性语言都可以表示为一个能被Java虚拟机所接受的有效的Class文件。

作为一个**通用的、机器无关**的**执行平台**， 任何其他语言的实现者都可以将Java虚拟机作为语言的产品交付媒介。例如，使用Java编译 器可以把Java代码编译为存储字节码的Class文件，使用JRuby等其他语言的编译器一样可以 把程序代码编译成Class文件，虚拟机并不关心Class的来源是何种语言，如图
![Snipaste_2019-04-02_11-47-53.jpg](https://i.loli.net/2019/04/02/5ca2db7e87ed4.jpg)

Java语言中的**各种变量、关键字和运算符号的语义**最终都是由**多条字节码命令组合而成**的，因此**字节码命令**所能提供的语义描述能力肯定会比Java语言本身更加强大。因此，**字节码本身**可以有效支持一 些Java语言本身无法有效支持的语言特性，这也为其他语言实现一些有别于Java的语言特性提供了基础。

**任何一个Class文件都对应着唯一一个类或接口的定义信息**，但反过来说，类或接 口并不一定都得定义在文件里（譬如类或接口也可以通过类加载器直接生成）。

Class文件是一组以8位字节为基础单位的二进制流，各个数据项严格按照顺序紧凑的排列在Class文件之中，中间没有添加任何分隔符，这使得整个Class文件中存储的内容几乎全部是程序运行的必要数据，没有空隙存在。当遇到需要占用8位字节以上空间的数据项时，则会按照高位在前的方式分割若干个8位字节进行存储。

根据Java虚拟机规范的规定，Class文件格式采用一种类似于C语言结构体的伪结构来存 储数据，这种伪结构中只有两种数据类型：**无符号数和表**。

**无符号数**：属于基本的数据类型，以u1、u2、u4、u8分别来代表1个字节、2个字节、4个字节和8个字节的无符号数，无符号数可以用来描述数字、索引引用、数量值或者按照UTF-8编码构成字符串值。

**表**：是由多个无符号数或者其他表作为数据项的复合数据数据类型，所有表都习惯性以**"_info"**结尾。表用于描述有层次关系的复合数据类型，整个Class文件本质上就是一张表，它由以下数据项构成。
![Snipaste_2019-04-02_12-19-41.jpg](https://i.loli.net/2019/04/02/5ca2e2e7d80b9.jpg)

