# 第2章 线程安全性

**线程安全性：**当多个线程访问某个类时，这个类始终都能表现出正确的行为，那么就称这个类是线程安全的。

**原子性**：一组语句作为不可分割的单元被执行。

**原子操作**：指对于访问同一个状态的所有操作（包括操作本身）来说，这个操作时一个以原子方法执行的操作。

**复合操作**：包含一组原子操作的操作。

**竞态条件**：当某个计算的正确性取决于多个线程的交替执行时序时，那么就会发生竞态条件。换句话说，就是正确的结果取决于运气。最长见的竞态条件的类型是“先检查后执行（Check-Then-Act）"操作。

## 加锁机制

由于每次只能有一个线程执行执行内置锁保护的代码块，因此，这个锁保护的代码块就以原子的方式执行，多个线程在执行该代码块时也不会相互干扰。

内置锁是可重入的，因此如果某个线程试图获得一个已经由它自己持有的锁时，那么这个请求就会成功。

“重入“意味着获取锁的操作粒度是”线程“而不是”调用“。

重入的一种实现方式是，为每一个锁关联一个获取计数值和一个所有者线程。

