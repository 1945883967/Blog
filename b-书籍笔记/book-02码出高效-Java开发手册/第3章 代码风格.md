# 第三章 代码风格

## 3.1 命名规约

代码元素包括类、方法、参数、常量、变量等程序中的各种元素，为了统一代码风格，元素的命名要遵守以下规定：

1. **符合本语言特性**

   比如：在Java中，所有代码元素的命名均不能以下划线或美元符号开始或结束。

2. **命名体现代码元素特征**

   面向对象代码元素的两大类命名：
   
   * 大驼峰命名：首字母大写的UpperCamelCase（类名）
   * 小驼峰命名：首字母小写lowerCamelCase（变量，包括参数，成员变量，局部变量）
   
   推荐在Java命名时，以下列方式体现元素特征：
   
   * 包名统一使用小写，点分割符之间有且仅有一个自然语义的英文单词。包名统一使用单数形式，但类名如果有复数含义，则可以使用复数形式。
   * 抽象类命名使用Abstract或Base开头；异常类命名使用Exception结尾，测试类命名以它要测试的类名开始，以Test结尾。
   * 类型与中括号紧挨相连来定义数组。
   * 枚举类名带上Enum后缀，枚举成员名称需要全部大写，单词间用下划线隔开。
   
3. **类名最好能望文知义**

### 3.1.1 常量

常量是在作用域内保持不变的值，一般用final关键字进行修饰，根据作用域分为：

* 全局常量：公开静态属性，使用public static final修饰（子母全部大写、单词之间使用下划线）
* 类内常量：私有静态属性，使用private static final修饰（子母全部大写、单词之间使用下划线）
* 局部常量：分为方法常量和参数常量（以小驼峰命名）
  1. 方法常量：在方法或代码块中定义的常量
  2. 参数常量：定义形式参数时，增加final标识，表示此参数不能被修改。

### 3.1.2 变量

广义：在程序中变量是一切通过分配内存并赋值的量，分为不可变量（常量）和可变变量。

侠义：变量仅指在程序运行过程中可以改变其值的量，包括成员变量和局部可变变量。

## 3.2 代码风格展示

### 3.2.1 缩进、空格和空行

**1. 缩进**

缩进表示层次对应关系。

在团队协作中，为求一致性风格，推荐采用4个空格缩进，禁止使用Tab键。

注:由于不同的编辑器对Tab的解析不一致，因此视觉体验有差异，而空格在编辑器之间是兼容的。

IDEA设置Tab为4个空格时，请勿勾选Use tab character；而Eclipse中，必须勾选Insert spaces for tabs。

**2. 空格**

空格用于分隔不同的编程元素。空格可以让运算符、数值、注释、参数等各种编程元素之间错落有致，方便快速定位。空格的使用有如下约定：

1. 任何二目、三目运算符的左右两边都必须加一个空格。
2. 注释的双斜线与注释内容之间有且仅有一个空格。
3. 方法参数在定义和传入时，多个参数逗号后边必须加空格。
4. 没有必要增加若干空格使变量的赋值等号与上一行对应位置的等号对齐。
5. 如果是大括号内为空，则简洁地写成｛｝即可，大括号中间无须换行和空格。
6. 左右小括号与括号内部的相邻字符之间不要出现空格。
7. 左大括号前需要加空格。

完整代码示例：

```java
public class SpaceCodeStyle {
	// 没有必要增加加若干空格使变量的赋值等号与上一行对应位置的等号对齐
	private static Integer one = 1;
	private static Long two = 2L;
	private static Float three = 3F;
	private static StringBuilder sb = new StringBuilder("code style:");
	
	// 缩进4个空格（注意：本代码中的任何注释在双斜杠与注释内容之间有且仅有一个空格）
	public static void main(String[] args) {
		// 继续缩进4个空格
		try {
			// 任何二目运算的左右必须有一个空格
			int count = 0;
			// 任何三目运算符的左右两边都必须有一个空格
			boolean condition = (count == 0) ? true : false;
			
			// 关键字if与左侧小括号之间必须有一个空格
			// 左括号内的子母c与左括号、子母n与右括号都不需要空格
			// 右括号与左括号前加空格且不换行，左括号后必须换行
			if (condition) {
				System.out.println("world");
				// else的前后都必须有空格
				// 右大括号前换行，右大括号后有else时，不用换行
			} else {
				System.out.println("ok");
				// 在有大括号后直接结束，则必须换行
			}
		// 如果是大括号内为空，则简洁地写成｛｝即可，大括号中间无须换行和空格
		} catch (Exception e) {}
		
		// 在每个实参逗号之后必须有一个空格
		String result = getString(one, two, three, sb);
		System.out.println(result);
	}
	
	// 方法之间，通过空行进行分割。在方法定义中，每个形参之后必须有一个空格
	private static String getString(Integer one, Long two, Float three, 
			StringBuilder sb) {
		// 任何二目运算的左右必须有一个空格，包括复制运算符，加号运算符等
		Float temp = one + two + three;
		sb.append(temp);
		return sb.toString();
	}
}
```

**3. 空行**

空行用来分隔功能相似、逻辑内聚、意思相近的代码片段，使得程序布局更加清晰。在浏览代码时，空行可以起到自然停顿的作用，提升阅读代码的体验。在方法定义之后、属性定义与方法之间、不同逻辑、不同语义、不同业 务的代码之间都需要通过空行来分隔。

### 3.2.2 换行与高度

**1. 换行**

代码中需要限定每行的字符个数，以便适配显示器的宽度，以及方便 CodeReview 时进行 diff 比对。 约定单行字符数不超过 120 个，超出则需要换行，换行时遵循如下原则

* 第二行相对第一行缩进四个空格，从第三行开始， 不再继续缩进， 参考示例。
*  运算符与下文一起换行。
* 方法调用的点符号与下文一起换行。
* 方法调用中的多个参数需要换行时， 在逗号后换行。
* 在括号前不要换行。

**2. 方法行数限制**

约定单个方法的总行数不超过 80 行。详细的判定标准如下 ， 除注释之外，方法签名、左右大括号、方法内代码、空行、回车及任何不可见字符的总行数不超过 80 行。为什么是 80 行？心理学认为人对事物的印象通常不能超过 3 这个魔法数， 三屏是人类短期记忆的极限，而 80 行在一般显示器上是两屏半的代码量。

### 3.2.3 控制语句

控制语句是底层机器码指令的具体实现。方法内部的跳转控制主要由条件语句和循环语句实现。

控制语句应该遵循以下约定：

* 在if、else、for、while、do-while等语句中必须使用大括号。即使有一行代码，也需要加上大括号。
* 在条件语句中不允许有复制操作，也不允许在判断表达式中出现复杂的逻辑组合。
* 多层嵌套不能超过三层。
* 避免采用取反逻辑运算符。

## 3.3 代码注释

### 3.3.1 注释三要素

注释能够准确反映设计思想和代码逻辑；能够描述业务含义。使其他工程师能迅速了解背景知识。

满足优雅注释的三要素：

1. Nothing is strange
2. Less is more
3. Advance with the times

### 3.3.2 注释格式

注释格式分为两种：一种是Javadoc规范，另一种是简单注释。

1. Javadoc规范

   类、类属性和类方法的注释必须遵循Javadoc规范，使用文档注释（/** */)的格式。按 Javadoc 规范编写的注释，可以生成规范的 JavaAPI 文档，为外部用户提供非常有效的文档支持。

2. 简单注释

   包括单行注释和多行注释。特别强调此类注释不允许写在代码后方，必须写在代 码上万， 这是为了避免注释的参差不齐，导致代码版式混乱。

