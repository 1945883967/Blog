# 第八章 虚拟机字节码执行引擎

代码编译的结果从本地机器码转变为字节码，是存储格式的一小步，却是编程语言的一大步。

## 8.1 概述

执行引擎是Java虚拟机最核心的组成部分之一。“虚拟机”是一个相对于“物理机”的概念，这两种机器都有**代码执行能力**，其区别是物理机的执行引擎是直接建立在处理器、硬件、指令集和操作系统层面上的，而虚拟机的执行引擎则是自己实现的，因此可以自行制定指令集与执行引擎的结构体系，并且能够执行那些不被硬件直接支持的指令集格式。

在Java虚拟机规范中制定了虚拟机字节码执行引擎的概念模型，这个概念模型成为各种 虚拟机执行引擎的统一外观（Facade）。在不同的虚拟机实现里面，执行引擎在执行Java代码的时候可能会有解释执行（通过解释器执行）和编译执行（通过即时编译器产生本地代码执行）两种选择，也可两者兼备，甚至还可能会包含几个不同级别的编译器执行引擎。从外观来看，所有的java虚拟机执行引擎都是一致的：输入的是字节码文件，处理过程是字节码解析的等效过程，输出是执行结果。

## 8. 2 运行时栈帧结构

**栈帧（Stack Frame）**：是用于支持虚拟机进行方法调用和方法执行的数据结构，它是虚拟机运行时数据区中的虚拟机栈（VirtualMachine Stack）的元素。每一个栈帧都包括了方法的局部变量表、操作数栈、动态链接和方法放回地址和一些额外的附加信息。每一个方法从调用开始至执行完成的过程，对应着一个栈帧在虚拟机栈里面从入栈到出栈的过程。

