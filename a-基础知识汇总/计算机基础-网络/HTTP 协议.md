# HTTP 协议

## HTTP  协议相关概念

**HTTP 协议(HyperText Transfer Protocol)**：超文本传输协议，从名字可以看出，它由 超文本、传输、协议三部分组成。

* 协议：HTTP 是一个用在计算机世界里的协议。它使用计算机能够理解的语言确立了一种计算机之间交流通信的规范，以及相关的各种控制和错误处理方式。

* 传输：HTTP 是一个在计算机世界里专门用来在两点之间传输数据的约定和规范。

  > 1、HTTP协议是一个“双向协议”
  >
  > 2、不限定两个角色，允许有中转或接力A<=>X<=>Y<=>Z<=>B

* 超文本：就是“超越了普通文本的文本”，它是文字、图片、音频和视频等的混合体，最关键的是含有“超链接”，能够从一个“超文本”跳跃到另一个“超文本”，形成复杂的非线性、网状的结构关系。

  > 所谓“文本”（Text），就表示 HTTP 传输的不是 TCP/UDP 这些底层协议里被切分的杂乱无章的二进制包（datagram），而是完整的、有意义的数据，可以被浏览器、服务器这样的上层应用程序处理。

**HTTP 是一个在计算机世界里专门在两点之间传输文字、图片、音频、视频等超文本数据的约定和规范。**

**URI/URL**：

URI（Uniform Resource Identifier），中文名称是 统一资源标识符，使用它就能够唯一地标记互联网上资源。

URI的基本组成部分：协议名，主机名，路径。

> http://   nginx.org   /en/download.html
>
> 协议名  主机名         路径

URI 另一个更常用的表现形式是 URL（Uniform Resource Locator）， 统一资源定位符，也就是我们俗称的“网址”，它实际上是 URI 的一个子集，差异不大，所以通常不会做严格的区分。

## HTTP 报文

HTTP的核心是：它传输的报文内容

### 报文结构

TCP 报文有 20 字节的头部数据，存储 TCP 协议必须的额外信息，例如发送方的端口、接受方的端口、包序号、标志位等等

![img](https://static001.geekbang.org/resource/image/17/95/174bb72bad50127ac84427a72327f095.png)



HTTP 协议的请求报文和响应报文的结构基本相同，由三大部分组成：

1. 起始行（start line）：描述请求或响应的基本信息；
2. 头部字段集合（header）：使用 key-value 形式更详细地说明报文；
3. 消息正文（entity）：实际传输的数据，它不一定是纯文本，可以是图片、视频等二进制数据。

这其中起始行和头部字段经常又称为 **请求头** 或 **响应头**，消息正文又称为**实体**(很多时候直接称为 **body**)

HTTP 协议规定报文必须有 header，但可以没有 body，而且在 header 之后必须要有一个“空行”，也就是“CRLF”，十六进制的“0D0A”。一个完整的 HTTP 报文如下图所示：

![img](https://static001.geekbang.org/resource/image/62/3c/62e061618977565c22c2cf09930e1d3c.png)

### 起始行

#### 请求行

**请求行(request line)**：简要地描述了客户端想要如何操作服务器端的资源。

请求行由三部分构成：

1. 请求方法：是一个动词，如 GET/POST，表示对资源的操作；
2. 请求目标：通常是一个 URI，标记了请求方法要操作的资源；
3. 版本号：表示报文使用的 HTTP 协议版本。

这三个部分通常使用空格（space）来分隔，最后要用 CRLF 换行表示结束。

![img](https://static001.geekbang.org/resource/image/36/b9/36108959084392065f36dff3e12967b9.png)

Wireshark 抓包的请求行为

```
GET / HTTP/1.1
```

> “GET”是请求方法，“/”是请求目标，“HTTP/1.1”是版本号

#### 状态行

**状态行(status line)**：意思是服务器响应的状态。

> 响应报文里的起始行。

也由三部分组成

1. 版本号：表示报文使用的 HTTP 协议版本；
2. 状态码：一个三位数，用代码的形式表示处理的结果，比如 200 是成功，500 是服务器错误；
3. 原因：作为数字状态码补充，是更详细的解释文字，帮助人理解原因。

![img](https://static001.geekbang.org/resource/image/a1/00/a1477b903cd4d5a69686683c0dbc3300.png)

Wireshark 抓包案例：

```
HTTP/1.1 200 OK
```

### 头部字段

请求行或状态行再加上头部字段集合就构成了 HTTP 报文里完整的请求头或响应头。

头部字段是 key-value 的形式，key 和 value 之间用“:”分隔，最后用 CRLF 换行表示字段结束。

HTTP 头字段非常灵活，不仅可以使用标准里的 Host、Connection 等已有头，也可以任意添加自定义头。

> **注意**：
>
> 1. 字段名不区分大小写
> 2. 字段名里不允许出现空格，可以使用连字符“-”，但不能使用下划线“_”。
> 3. 字段名后面必须紧接着“:”，不能有空格，而“:”后的字段值前可以有多个空格；
> 4. 字段的顺序是没有意义的，可以任意排列不影响语义；
> 5. 字段原则上不能重复，除非这个字段本身的语义允许，例如 Set-Cookie。

**请求头字段**

HTTP 协议规定了非常多的头部字段，实现各种各样的功能，但基本上可以分为四大类：

1. 通用字段：在请求头和响应头里都可以出现；
2. 请求字段：仅能出现在请求头里，进一步说明请求信息或者额外的附加条件；
3. 响应字段：仅能出现在响应头里，补充说明响应报文的信息；
4. 实体字段：它实际上属于通用字段，但专门描述 body 的额外信息。

# DNS 协议

DNS  协议可能会经历从操作系统、本地 DNS、根DNS、顶级 DNS、权威 DNS 的层层解析的过程。为避免每次都经历这个复杂繁琐的过程，这中间会存在DNS缓存。



